# All configuration for plugins and other utils is defined here.
# Read more about `setup.cfg`:
# https://docs.python.org/3/distutils/configfile.html

[flake8]
format = wemake
show-source = True
statistics = True
doctests = True
enable-extensions = G

# Flake plugins:
max-line-length = 80
max-complexity = 6
accept-encodings = utf-8
radon-max-cc = 10
radon-show-closures = True
radon-no-assert = True
inline-quotes = single
nested-classes-whitelist = Meta, Arguments, Media

# Excluding some directories:
exclude = .git,__pycache__,.venv,.eggs,*.egg,server/*/migrations/*.py

# Disable some pydocstyle checks:
ignore = D100, D104, D106, D401, X100, W503, RST303, RST304, DAR103, DAR203,
         WPS306, WPS317, WPS121
         # 44    WPS347 Found vague import that may cause confusion: *
         WPS347
         # 40    WPS221 Found line with high Jones Complexity: 15
         WPS221
         ;20    G001 Logging statement uses string.format()
         G001
         ;12    WPS110 Found wrong variable name: handle
         WPS110
         ;3     WPS111 Found too short name: t
         WPS111
         ;1     WPS201 Found module with too many imports: 21
         WPS201
         ;1     WPS210 Found too many local variables: 8
         WPS210
         ;3     WPS219 Found too deep access level: 5
         WPS219
         ;19    WPS226 Found string constant over-use: Do filtering.
         WPS226
         ;1     WPS336 Found explicit string concat
         WPS336
         ;7     WPS440 Found block variables overlap: *
         WPS440
         ;12    D101 Missing docstring in public class
         D101
         ;14    D102 Missing docstring in public method
         D102
         ;18    F403 'from .parsers import *' used; unable to detect undefined names
         F403

per-file-ignores =
  server/settings/environments/development.py: WPS226, WPS407, WPS412, WPS432,
  E800, S105
  server/settings/*.py: WPS226, WPS407, WPS412, WPS432
  tests/*.py: S101, WPS432, WPS226, WPS442
;3     A001 "filter" is a python builtin and is being shadowed, consider renaming the variable
  A001
;12    A003 "id" is a python builtin, consider renaming the class attribute
  A003
;2     B006 Do not use mutable data structures for argument defaults.  They are created during function definition time. All calls to the function reuse this one instance of that data structure, persisting changes between them.
  B006
;121   C101 Coding magic comment not found
  C101
;3     C401 Unnecessary generator - rewrite as a set comprehension.
  C401
;4     C407 Unnecessary list comprehension - 'all' can take a generator.
  C407
;1     C412 Unnecessary list comprehension - 'in' can take a generator.
  C412
;885   C812 missing trailing comma
  C812
;15    C815 missing trailing comma in Python 3.5+
  C815
;2     C819 trailing comma prohibited
  C819
;541   D103 Missing docstring in public function
  D103
;6     D107 Missing docstring in __init__
  D107
;48    E111 indentation is not a multiple of four
  E111
;4     E121 continuation line under-indented for hanging indent
  E121
;1     E123 closing bracket does not match indentation of opening bracket's line
  E123
;2     E302 expected 2 blank lines, found 1
  E302
;68    E501 line too long (88 > 80 characters)
  E501
;1     E800: Found commented out code
  E800
;4     F401 'tests.test_development.factories.LabelFactory' imported but unused
  F401
;4     F841 local variable 'm2' is assigned to but never used
  F841
;190   I001 isort found an import in the wrong position
  I001
;8     I003 isort expected 1 blank line in imports, found 0
  I003
;6     I004 isort found an unexpected blank line in imports
  I004
;29    N400: Found backslash that is used for line breaking
  N400
;13    PT001 use @pytest.fixture() over @pytest.fixture
  PT001
;3     Q001 Remove bad quotes from multiline string
  Q001
;73    S106 Possible hardcoded password: 'GITLAB_TOKEN'
  S106
;1     S311 Standard pseudo-random generators are not suitable for security/cryptographic purposes.
  S311
;124   T003 use of Django-style assert statement found (instead of regular assert): assertEqual
  T003
;1     W293 blank line contains whitespace
  W293
;2     W391 blank line at end of file
  W391
;372   WPS114 Found underscored name pattern: user_2
  WPS114
;5     WPS118 Found too long name: test_merge_requests_filter_by_team_watcher_empty
  WPS118
;29    WPS202 Found too many module members: 14
  WPS202
;207   WPS204 Found overused expression: TeamFactory.create(); used 9 times
  WPS204
;7     WPS211 Found too many arguments: 6
  WPS211
;13    WPS213 Found too many expressions: 11
  WPS213
;2     WPS214 Found too many methods: 9
  WPS214
;22    WPS218 Found too many `assert` statements: 6
  WPS218
;283   WPS305 Found `f` string
  WPS305
;1     WPS309 Found reversed compare order
  WPS309
;358   WPS318 Found extra indentation
  WPS318
;501   WPS319 Found bracket in wrong position
  WPS319
;3     WPS324 Found inconsistent `return` statement
  WPS324
;5     WPS326 Found implicit string concatenation
  WPS326
;1     WPS335 Found incorrect `for` loop iter type
  WPS335
;3     WPS355 Found an unnecessary blank line before a bracket
  WPS355
;2     WPS404 Found complex default value
  WPS404
;9     WPS428 Found statement that has no effect
  WPS428
;2     WPS430 Found nested function: replace
  WPS430
;4     WPS437 Found protected attribute usage: _messages
  WPS437
;2     WPS441 Found control variable used after block: error
  WPS441
;7     WPS520 Found compare with falsy constant
  WPS520
;16    WPS529 Found implicit `.get()` dict usage
  WPS529
;1     WPS600 Found subclassing a builtin: dict
  WPS600



  server/*/**/__init__.py: F401, WPS300, WPS412, I001
  server/*/admin/*.py: WPS226
  server/__init__.py: WPS412

[tool:pytest]
# Django configuration:
# https://pytest-django.readthedocs.io/en/latest/
DJANGO_SETTINGS_MODULE = server.settings

# Timeout for tests, so they can not take longer
# than this amout of seconds.
# You should adjust this value to be as low as possible.
# Configuration:
# https://pypi.org/project/pytest-timeout/
timeout = 5

# Directories that are not visited by pytest collector:
norecursedirs = *.egg .eggs dist build docs .tox .git __pycache__

# You will need to measure your tests speed with `-n auto` and without it,
# so you can see whether it gives you any performance gain, or just gives
# you an overhead.
addopts =
  --strict
  --tb=short
  --fail-on-template-vars
  --reuse-db
# -n auto
# --boxed
  --cov=server
  --cov=tests
  --cov-branch
  --cov-report=term-missing:skip-covered
  --cov-report=html
  --cov-fail-under=90


[isort]
# isort configuration:
# https://github.com/timothycrosley/isort/wiki/isort-Settings
include_trailing_comma = true
# See https://github.com/timothycrosley/isort#multi-line-output-modes
multi_line_output = 3
default_section = FIRSTPARTY
# Should be: 80 - 1
line_length = 79


[darglint]
# darglint configuration:
# https://github.com/terrencepreilly/darglint
strictness = long

[mypy]
python_version = 3.6

allow_redefinition = False
#check_untyped_defs = True
#disallow_untyped_decorators = True
#disallow_any_explicit = True
#disallow_any_generics = True
disallow_untyped_calls = True
ignore_errors = False
ignore_missing_imports = True
implicit_reexport = False
strict_optional = True
strict_equality = True
no_implicit_optional = True
warn_unused_ignores = True
warn_redundant_casts = True
warn_unused_configs = True
warn_unreachable = True
warn_no_return = False
#warn_no_return = True

[mypy-server.*.migrations.*]
ignore_errors = True

[mypy-tests.*]
ignore_errors = True

[mypy-server.apps.*.models]
# FIXME: remove this line, when `django-stubs` will stop
# using `Any` inside.
disallow_any_explicit = False


[doc8]
ignore-path = docs/_build
max-line-length = 80
sphinx = True
